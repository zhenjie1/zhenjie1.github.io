webpackJsonp([4],{DYon:function(t,e){},WAr1:function(t,e){},fsMx:function(t,e){},sFWC:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("hRKE"),i=n.n(a),s=n("4YfN"),o=n.n(s),c=n("JGLT"),r="ws://"+n("ij9N").b+"/a/tjSocket",u=function(t){var e=new WebSocket(r);e.onopen=function(t){console.log("连接成功"),e.send("Hello WebSockets!")},e.onmessage=function(e){var n="string"==typeof e.data?JSON.parse(e.data):e.data;t(n)},e.onclose=function(t){console.log("断开连接")}},l=n("K2f2"),f={data:function(){return{data:[]}},props:["originaId"],methods:{ok:function(){var t=this,e=[];if(this.data.forEach(function(t){t.check&&e.push(t.id)}),0===e.length)return alert("请至少选择一人！"),!1;Object(l.b)(this.originaId,e).then(function(e){2==e.code?(t.$emit("down",!0),alert("接单成功")):t.$emit("down",e.msg)})},initData:function(){var t=this;Object(l.p)().then(function(e){t.data=e.rows})},down:function(){this.$emit("down",!1)}},mounted:function(){this.initData()}},d={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"personnel"},[n("div",{staticClass:"con"},[n("div",{staticClass:"down",on:{click:t.down}},[n("i",{staticClass:"iconfont icon-guanbi"})]),t._v(" "),t._m(0),t._v(" "),n("div",{staticClass:"pers"},t._l(t.data,function(e,a){return 0==e.status?n("p",{key:a,class:{checked:e.check},on:{click:function(t){e.check=!e.check}}},[t._v(t._s(e.name))]):t._e()})),t._v(" "),n("div",{staticClass:"okBtn",on:{click:t.ok}},[n("span",[t._v("选择好了")])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tit"},[e("span",[this._v("请选择出勤人员")])])}]};var h,p,v=n("C7Lr")(f,d,!1,function(t){n("wRtY")},"data-v-3912c09a",null).exports,b=n("vgQg"),m=n("yclV"),_=n("rVsN"),k=n.n(_),w=n("lC5x"),g=n.n(w),y=n("J0Oq"),C=n.n(y),x=n("HzJ8"),D=n.n(x),I=(h=C()(g.a.mark(function t(e,n){return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n,t.next=1===t.t0?3:2===t.t0?5:3===t.t0?8:4===t.t0?11:5===t.t0?14:17;break;case 3:return Object(l.Y)(1).then(function(t){e.total=t.total,t=t.rows,e.infoData=t,e.originalData=t,O(e.infoData)}),t.abrupt("break",17);case 5:return t.next=7,Object(l.Z)().then(function(t){t=t.rows,e.infoData=t,e.originalData=t,O(e.infoData)});case 7:return t.abrupt("break",17);case 8:return t.next=10,Object(l.W)().then(function(t){t=t.rows,e.infoData=t,e.originalData=t,O(e.infoData)});case 10:return t.abrupt("break",17);case 11:return t.next=13,Object(l.X)(1).then(function(t){t=t.rows,e.infoData=t,e.originalData=t,O(e.infoData)});case 13:return t.abrupt("break",17);case 14:return t.next=16,Object(l.Y)(1,"99").then(function(t){t=t.rows,e.infoData=t,e.originalData=t,O(e.infoData)});case 16:return t.abrupt("break",17);case 17:e.$refs.li&&(e.liLength=e.$refs.li.length);case 18:case"end":return t.stop()}},t,this)})),function(t,e){return h.apply(this,arguments)});try{p=parseInt(Object(m.a)("userInfo").userType)}catch(t){}function O(t){var e=!0,n=!1,a=void 0;try{for(var i,s=D()(t);!(e=(i=s.next()).done);e=!0){var o=i.value;0==o.orderStautsList.length&&o.orderStautsList.push({content:"暂无进展"})}}catch(t){n=!0,a=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw a}}}var j=function(t,e){switch(e=parseInt(e)){case 2:Object(l.o)().then(function(e){e=e.rows,t.infoData=e,t.originalData=e,O(t.infoData)}).then(function(){t.isShow()});break;case 3:Object(l.Y)(1).then(function(e){t.total=e.total,e=e.rows,t.infoData=e,t.originalData=e,t.liLength=e.length,O(t.infoData)});break;case 4:Object(l.n)(1).then(function(e){e=e.rows,t.infoData=e,t.originalData=e,O(t.infoData)}).then(function(){t.isShow()})}},S=function(t,e,n,a,i){e=parseInt(e),t.clickObj=n,t.originaId=n.id,2===e?R(t,n,a,i):3===e?(0==a&&"救援进展"==i&&t.$router.push("/rescue/task/progress"),0==a&&-1!==i.indexOf("取消")&&(t.showCancel=!0)):4===e&&R(t,n,a,i)},E=function(t){var e=t.navIndex;3==p?I(t,e):function(t,e){new k.a(function(n,a){if(4!=e){var i=[];Array.isArray(t.originalData)&&(t.originalData.forEach(function(t,n){1==e?0!=t.stateId&&1!=t.stateId||i.push(t):e==t.stateId&&i.push(t)}),t.infoData=i,O(t.infoData),n())}else Object(l.q)(1,10).then(function(e){e=e.rows,t.infoData=e,O(t.infoData),n()})}).then(function(){setTimeout(function(){t.liLength=void 0==t.$refs.li?0:t.$refs.li.length},0)})}(t,e)},$=function(t,e){if(t=parseInt(t),2==p){var n=[[{name:"拒绝接单",type:"button"},{name:"确认接单",type:"button"}],[{name:"确认出发",type:"button"}],[{name:"拍摄",type:"file"},{name:"确认到达",type:"button"}],[{name:"拍摄",type:"file"},{name:"完成",type:"button"}],[{name:"0"===e.typeReport?"上传报告":"查看报告",type:"button"},{name:"0"===e.typeReturn?"上传回访":"查看回访",type:"button"}]];switch(t){case 0:t="等待接单",e.btn=n[0];break;case 1:t="等待出发",e.btn=n[1];break;case 2:t="已到达救援地点",e.btn=n[2];break;case 3:t="施救中",e.btn=n[3];break;case 4:t="完成",e.btn=n[4];break;default:t="未知状态"}}else if(3==p){n=[[{name:"取消订单",type:"button"}],[{name:"救援进展",type:"button"}],[{name:"救援进展",type:"button"}],[{name:"救援进展",type:"button"}],[{name:"救援进展",type:"button"}]];switch(t){case 0:t="等待接单",e.btn=n[0];break;case 1:t="等待出发",e.btn=n[1];break;case 2:t="已到达救援地点",e.btn=n[2];break;case 3:t="施救中",e.btn=n[2];break;case 4:t="已完成",e.btn=n[3];break;case 99:t="已取消",e.btn=n[4];break;default:t="未知状态"}}else if(4==p){n=[[{name:"拒绝接单",type:"button"},{name:"确认接单",type:"button"}],[{name:"确认出发",type:"button"}],[{name:"拍摄",type:"file"},{name:"确认到达",type:"button"}],[{name:"拍摄",type:"file"},{name:"完成",type:"button"}],[{name:"0"===e.typeReport?"上传报告":"查看报告",type:"button"},{name:"0"===e.typeReturn?"上传回访":"查看回访",type:"button"}]];switch(t){case 0:t="等待接单",e.btn=n[0];break;case 1:t="等待出发",e.btn=n[1];break;case 2:t="已到达救援地点",e.btn=n[2];break;case 3:t="施救中",e.btn=n[3];break;case 4:t="完成",e.btn=n[4];break;default:t="未知状态"}}return t};function R(t,e,n,a){switch(console.log(a),e.stateId=parseInt(e.stateId),e.stateId){case 0:1==n?(t.originaId=e.id,t.isShowPer=!0):t.showCancelRefuse=!0;break;case 2:case 3:1==n&&t.statusSet(e);break;case 4:0==n?"上传报告"==a?t.$router.push("/rescue/task/update/"+e.id+"/1"):"查看报告"==a&&t.$router.push("/rescue/report/"+e.id+"/1"):"上传回访"==a?t.$router.push("/rescue/task/update/"+e.id+"/0"):"查看回访"==a&&t.$router.push("/rescue/report/"+e.id+"/0"),console.log("不请求，而是跳转页面 --- 点击的是第 "+n+" 个"),-1!==a.indexOf("上传")&&console.log("点击的是上传·");break;default:console.log("报错了，快去看看代码吧！"),t.statusSet(e)}}var L=n("wEVy"),T=n("zG2y"),N=n("9rMa"),Y=(o()({},Object(N.c)(["userInfo"])),T.a,c.a,{data:function(){return{showCancelRefuse:!1,showCancel:!1,navIndex:1,currentView:"orders",isShowPer:!1,infoData:[],pageNum:1,liLength:-1,userType:"",total:0,socketData:{},originalData:[],originaId:"",clickObj:"",test:"",RescueMenu:[]}},computed:o()({},Object(N.c)(["userInfo"])),filters:{office:function(t){return"object"==(void 0===t?"undefined":i()(t))?t.name:""==t||void 0==t?"救援机构未分配":t},status:function(t,e){return $(t,e)}},watch:{$route:"initData"},created:function(){m.d.call(this)||(this.$vux.toast.text("请先登录！"),this.$router.push("/user/login")),Object(L.a)(this)},methods:{cancelRefuseEv:function(t){var e=this;""!=t?Object(l.g)(this.originaId,t).then(function(t){e.clickObj.stateId="99"}):alert("请输入拒绝理由！")},localItem:function(t){Object(m.g)("viewCurrentData",t)},cancelEv:function(t){var e=this;""!=t?Object(l.h)(this.originaId,t).then(function(t){e.clickObj.stateId="99"}):alert("请输入拒绝理由！")},mapEv:function(t){sessionStorage.lngLat=t.jingwei},imgResult:function(t){t.target.files.length>0&&alert("拍摄成功")},listIsShow:function(t){return 3==this.userType||(1==this.navIndex?0==t.stateId||1==t.stateId:t.stateId==this.navIndex)},isShow:function(){E(this)},personal:function(){3==this.userType?this.$router.push("/user/home"):this.$router.push("/personal")},initData:function(){j(this,this.userType)},downEv:function(t){if(!0===t){for(var e=0;e<this.infoData.length;e++)if(this.infoData[e].id==this.originaId){this.infoData[e].stateId=1;break}this.isShowPer=!1}else!1===t?this.isShowPer=!1:alert(t)},statusSet:function(t){Object(l.F)(t.id,t.stateId+1).then(function(e){2==e.code&&(t.stateId=t.stateId+1)})},accept:function(t,e,n){S(this,this.userType,t,e,n)}},mounted:function(){var t=this;try{this.userType=this.userInfo.userType}catch(t){this.$router.push("/user/login")}this.RescueMenu=3==this.userType?b.c:b.a,this.initData();u(function(e){console.log(e),1==e.code?(alert("你有新的任务"),t.infoData.splice(0,0,e.rows)):3==e.code||2==e.code&&(alert("你有新的任务"),t.infoData.splice(0,0,e.rows))})},components:{Personnel:v,BottomLine:T.a,Confirm:c.a}}),M={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"task"},[n("ul",{staticClass:"nav"},t._l(t.RescueMenu,function(e,a){return n("li",{key:a,class:{checked:a==t.navIndex-1},on:{click:function(e){t.navIndex=a+1,t.isShow()}}},[n("span",[t._v(t._s(e))])])})),t._v(" "),n("div",{staticClass:"ordersComm Orders"},[n("ul",t._l(t.infoData,function(e,a){return t.listIsShow(e)?n("li",{key:a,ref:"li",refInFor:!0,class:"order",on:{click:function(n){t.localItem(e)}}},[n("router-link",{attrs:{to:"/rescue/task/details"}},[n("div",{staticClass:"title"},[n("p",[t._v("救援单号："+t._s(e.uuid))]),t._v(" "),n("span",[t._v(t._s(t._f("status")(e.stateId,e)))])]),t._v(" "),3==t.userType?n("div",{staticClass:"track"},[n("i",{staticClass:"iconfont icon-che"}),t._v(" "),n("div",{staticClass:"r"},[n("h2",[t._v(t._s(e.orderStautsList[0].content))]),t._v(" "),n("span",[t._v(t._s(e.createDate))])])]):t._e(),t._v(" "),n("div",{staticClass:"info"},[n("img",{staticClass:"icon",attrs:{src:"",alt:""}}),t._v(" "),n("div",{staticClass:"con"},[n("h3",[t._v(t._s(t._f("office")(e.office)))]),t._v(" "),n("p",[n("span",[t._v(t._s(t._f("Rescue")(e.rangeId)))]),t._v(" "),n("b",[t._v(t._s(e.createDate))])])])])]),t._v(" "),""!==e.remarks?n("div",{staticClass:"note"},[n("i",{staticClass:"iconfont icon-jinggao"}),t._v(" "),n("span",[t._v("备注")]),t._v(" "),n("p",[t._v(t._s(e.remarks))])]):t._e(),t._v(" "),3!=t.userType?n("router-link",{attrs:{to:"/rescue/map"},nativeOn:{click:function(n){t.mapEv(e)}}},[n("div",{staticClass:"position"},[n("i",{staticClass:"iconfont icon-weizhi"}),t._v(" "),n("p",[t._v(t._s(e.place))]),t._v(" "),n("span",{staticStyle:{opacity:"0"}},[t._v("22.22km")]),t._v(" "),n("b",{attrs:{href:""}},[t._v("查看地图 "),n("i",{staticClass:"iconfont icon-shuangjiantouyou"})])])]):n("div",[n("div",{staticClass:"position"},[n("i",{staticClass:"iconfont icon-weizhi"}),t._v(" "),n("p",[t._v(t._s(e.place))])])]),t._v(" "),99!=e.stateId?n("div",{staticClass:"btn"},t._l(e.btn,function(a,i){return n("div",{key:i,class:{file:"file"==a.type}},["file"==a.type?n("span",[t._v(t._s(a.name))]):t._e(),t._v(" "),n("input",{attrs:{type:a.type,accept:"image/*",capture:"camera"},domProps:{value:"button"==a.type?a.name:""},on:{click:function(n){t.accept(e,i,a.name)},change:t.imgResult}})])})):t._e()],1):t._e()})),t._v(" "),n("transition",{attrs:{name:"breadcrumb"}},[n("router-view"),t._v(" "),t.isShowPer?n("personnel",{attrs:{originaId:t.originaId},on:{down:t.downEv}}):t._e()],1)],1),t._v(" "),n("confirm",{attrs:{"hide-on-blur":!0,"show-input":!0,placeholder:"请输入取消理由",title:"取消理由",theme:"android","confirm-text":"确定","cancel-text":"取消"},on:{"on-confirm":t.cancelEv},model:{value:t.showCancel,callback:function(e){t.showCancel=e},expression:"showCancel"}}),t._v(" "),n("confirm",{attrs:{"hide-on-blur":!0,"show-input":!0,placeholder:"请输入拒绝理由",title:"拒绝理由",theme:"android","confirm-text":"确定","cancel-text":"取消"},on:{"on-confirm":t.cancelRefuseEv},model:{value:t.showCancelRefuse,callback:function(e){t.showCancelRefuse=e},expression:"showCancelRefuse"}}),t._v(" "),t.liLength>0?n("bottom-line"):t._e(),t._v(" "),0==t.liLength?n("div",{staticClass:"Empty"},[n("i",{staticClass:"iconfont icon-icondd1"}),n("p",[t._v("暂无数据")])]):t._e(),t._v(" "),3!=t.userType?n("div",{staticClass:"personal",on:{click:t.personal}},[n("i",{staticClass:"iconfont icon-wode"})]):n("div",{staticClass:"personal",on:{click:t.personal}},[n("i",{staticClass:"iconfont icon-home"})])],1)},staticRenderFns:[]};var P=n("C7Lr")(Y,M,!1,function(t){n("DYon"),n("fsMx")},"data-v-f5e31d52",null);e.default=P.exports},wEVy:function(t,e,n){"use strict";var a,i,s=n("lC5x"),o=n.n(s),c=n("J0Oq"),r=n.n(c),u=n("K2f2"),l=n("yclV"),f=(a=r()(o.a.mark(function t(e,n){var a,i,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Object(l.a)("userInfo").userType,i=e.navIndex,s=[],3!=a){t.next=14;break}if(1!=i){t.next=9;break}return t.next=7,Object(u.Y)(n).then(function(t){s=t.rows});case 7:t.next=12;break;case 9:if(4!=i){t.next=12;break}return t.next=12,Object(u.X)(n).then(function(t){s=t.rows});case 12:t.next=17;break;case 14:if(2!=a){t.next=17;break}return t.next=17,Object(u.q)(n).then(function(t){s=t.rows});case 17:h(e,s,"infoData");case 18:case"end":return t.stop()}},t,this)})),function(t,e){return a.apply(this,arguments)}),d=(i=r()(o.a.mark(function t(e,n,a){var i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=[],t.next=3,Object(u.j)(n,a).then(function(t){i=t.rows,e.isShowLoading=!1});case 3:h(e,i,"data");case 4:case"end":return t.stop()}},t,this)})),function(t,e,n){return i.apply(this,arguments)});function h(t,e,n){e.forEach(function(e){t[n].push(e)})}var p,v=n("bBgq"),b=n.n(v);e.a=function(t){p=t,window.addEventListener("scroll",b()(m,500))};function m(){if(function(){var t=0,e=0;document.body&&(t=document.body.scrollTop);document.documentElement&&(e=document.documentElement.scrollTop);return t-e>0?t:e}()+function(){var t=0;t="CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight;return t}()==function(){var t=0,e=0;document.body&&(t=document.body.scrollHeight);document.documentElement&&(e=document.documentElement.scrollHeight);return t-e>0?t:e}())if(-1!==p.$route.path.indexOf("/rescue/task")){if(p.total<10*p.pageNum)return;p.pageNum++,f(p,p.pageNum)}else if(-1!==p.$route.path.indexOf("/user/home")){if(p.total<10*p.pageNum)return;p.isShowLoading=!0;var t="sense"==p.currentView?"1":"2";p.pageNum++,d(p,p.pageNum,t)}}},wRtY:function(t,e){},zG2y:function(t,e,n){"use strict";var a={props:["text"],data:function(){return{txt:""}},mounted:function(){this.txt=void 0!==this.text?this.text:"我是有底线的"}},i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bottomLine"},[e("p",[this._v(this._s(this.txt))])])},staticRenderFns:[]};var s=n("C7Lr")(a,i,!1,function(t){n("WAr1")},"data-v-2935bb20",null);e.a=s.exports}});