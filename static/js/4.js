webpackJsonp([4],{BAHF:function(t,e){},EjqE:function(t,e){},K3TS:function(t,e){},OXZD:function(t,e){},sFWC:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("pFYg"),i=n.n(a),o=n("62KO"),s="ws://"+n("ij9N").b+"/a/tjSocket",c=n("K2f2"),r={data:function(){return{data:[]}},props:["originaId"],methods:{ok:function(){var t=this,e=[];if(this.data.forEach(function(t){t.check&&e.push(t.id)}),0===e.length)return alert("请至少选择一人！"),!1;Object(c.a)(this.originaId,e).then(function(e){2==e.code?(t.$emit("down",!0),alert("接单成功")):t.$emit("down",e.msg)})},initData:function(){var t=this;Object(c.l)().then(function(e){t.data=e.rows})},down:function(){this.$emit("down",!1)}},created:function(){this.initData()}},u={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"personnel"},[n("div",{staticClass:"con"},[n("div",{staticClass:"down",on:{click:t.down}},[n("i",{staticClass:"iconfont icon-guanbi"})]),t._v(" "),t._m(0),t._v(" "),n("div",{staticClass:"pers"},t._l(t.data,function(e,a){return 0==e.status?n("p",{key:a,class:{checked:e.check},on:{click:function(t){e.check=!e.check}}},[t._v(t._s(e.name))]):t._e()})),t._v(" "),n("div",{staticClass:"okBtn",on:{click:t.ok}},[n("span",[t._v("选择好了")])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tit"},[e("span",[this._v("请选择出勤人员")])])}]};var f,l,d=n("VU/8")(r,u,!1,function(t){n("BAHF")},"data-v-651c048c",null).exports,h=n("vgQg"),p=n("yclV"),v=n("//Fk"),b=n.n(v),m=n("Xxa5"),_=n.n(m),g=n("exGp"),y=(f=n.n(g)()(_.a.mark(function t(e,n){return _.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n,t.next=1===t.t0?3:2===t.t0?5:3===t.t0?8:4===t.t0?11:5===t.t0?14:17;break;case 3:return Object(c.D)(1).then(function(t){e.total=t.total,t=t.rows,e.infoData=t,e.originalData=t}),t.abrupt("break",17);case 5:return t.next=7,Object(c.E)().then(function(t){t=t.rows,e.infoData=t,e.originalData=t});case 7:return t.abrupt("break",17);case 8:return t.next=10,Object(c.B)().then(function(t){t=t.rows,e.infoData=t,e.originalData=t});case 10:return t.abrupt("break",17);case 11:return t.next=13,Object(c.C)(1).then(function(t){t=t.rows,e.infoData=t,e.originalData=t});case 13:return t.abrupt("break",17);case 14:return t.next=16,Object(c.D)(1,"99").then(function(t){t=t.rows,e.infoData=t,e.originalData=t});case 16:return t.abrupt("break",17);case 17:e.liLength=e.$refs.li.length;case 18:case"end":return t.stop()}},t,this)})),function(t,e){return f.apply(this,arguments)});!function t(){try{l=parseInt(Object(p.a)("userInfo").userType)}catch(t){}l||setTimeout(function(){t()},200)}();var k=function(t,e,n,a,i){e=parseInt(e),t.clickObj=n,t.originaId=n.id,2===e?function(t,e,n,a){switch(e.stateId=parseInt(e.stateId),e.stateId){case 0:1==n?(t.originaId=e.id,t.isShowPer=!0):t.showCancelRefuse=!0;break;case 2:case 3:1==n&&t.statusSet(e);break;case 4:console.log("不请求，而是跳转页面 --- 点击的是第 "+n+" 个"),-1!==a.indexOf("上传")&&console.log("点击的是上传·");break;default:console.log("报错了，快去看看代码吧！"),t.statusSet(e)}}(t,n,a,i):3===e&&1==a&&-1!==i.indexOf("取消")&&(t.showCancel=!0)},w=function(t){var e=t.navIndex;2==l?function(t,e){new b.a(function(n,a){if(4!=e){var i=[];Array.isArray(t.originalData)&&(t.originalData.forEach(function(t,n){1==e?0!=t.stateId&&1!=t.stateId||i.push(t):e==t.stateId&&i.push(t)}),t.infoData=i,n())}else Object(c.m)(1,10).then(function(e){e=e.rows,t.infoData=e,n()})}).then(function(){setTimeout(function(){t.liLength=void 0==t.$refs.li?0:t.$refs.li.length},0)})}(t,e):3==l&&y(t,e)};var x=n("wEVy"),C={data:function(){return{showCancelRefuse:!1,showCancel:!1,navIndex:1,currentView:"orders",isShowPer:!1,infoData:[],pageNum:1,liLength:-1,userType:"",total:0,socketData:{},originalData:[],originaId:"",clickObj:"",test:"",RescueMenu:[]}},filters:{office:function(t){return"object"==(void 0===t?"undefined":i()(t))?t.name:""==t||void 0==t?"救援机构未分配":t},status:function(t,e){return function(t,e){if(t=parseInt(t),2==l){var n=[[{name:"拒绝接单",type:"button"},{name:"确认接单",type:"button"}],[{name:"确认出发",type:"button"}],[{name:"拍摄",type:"file"},{name:"确认到达",type:"button"}],[{name:"拍摄",type:"file"},{name:"完成",type:"button"}],[{name:"0"===e.typeReport?"上传报告":"查看报告",type:"button"},{name:"0"===e.typeReturn?"上传回访":"查看回访",type:"button"}]];switch(t){case 0:t="等待接单",e.btn=n[0];break;case 1:t="等待出发",e.btn=n[1];break;case 2:t="在途中",e.btn=n[2];break;case 3:t="施救中",e.btn=n[3];break;case 4:t="完成",e.btn=n[4];break;default:t="未知状态"}}else if(3==l)switch(n=[[{name:"救援进展",type:"button"},{name:"取消订单",type:"button"}],[{name:"救援进展",type:"button"}],[{name:"救援进展",type:"button"}],[{name:"救援进展",type:"button"}],[{name:"救援进展",type:"button"}]],t){case 0:t="等待接单",e.btn=n[0];break;case 1:t="等待出发",e.btn=n[1];break;case 2:t="在途中",e.btn=n[2];break;case 3:t="施救中",e.btn=n[2];break;case 4:t="已完成",e.btn=n[3];break;case 99:t="已取消",e.btn=n[4];break;default:t="未知状态"}return t}(t,e)}},created:function(){Object(x.a)(this)},methods:{cancelRefuseEv:function(t){var e=this;""!=t?Object(c.c)(this.originaId,t).then(function(t){e.clickObj.stateId="99"}):alert("请输入拒绝理由！")},localItem:function(t){Object(p.b)("viewCurrentData",t)},cancelEv:function(t){var e=this;""!=t?Object(c.d)(this.originaId,t).then(function(t){console.log(t),e.clickObj.stateId="99"}):alert("请输入拒绝理由！")},mapEv:function(t){sessionStorage.lngLat=t.jingwei},imgResult:function(t){t.target.files.length>0?alert("拍摄成功"):alert("您未拍摄照片")},listIsShow:function(t){return 2==this.userType?1==this.navIndex?0==t.stateId||1==t.stateId:t.stateId==this.navIndex:3==this.userType||void 0},isShow:function(){w(this)},personal:function(){3==this.userType?this.$router.push("/user/home"):this.$router.push("/personal")},initData:function(){!function(t,e){switch(e=parseInt(e)){case 2:Object(c.k)().then(function(e){e=e.rows,t.infoData=e,t.originalData=e}).then(function(){t.isShow()});break;case 3:Object(c.D)(1).then(function(e){t.total=e.total,e=e.rows,t.infoData=e,t.originalData=e,t.liLength=e.length})}}(this,this.userType)},downEv:function(t){if(!0===t){for(var e=0;e<this.infoData.length;e++)if(this.infoData[e].id==this.originaId){this.infoData[e].stateId=1;break}this.isShowPer=!1}else!1===t?this.isShowPer=!1:alert(t)},statusSet:function(t){Object(c.s)(t.id,t.stateId+1).then(function(e){2==e.code&&(t.stateId=t.stateId+1)})},accept:function(t,e,n){k(this,this.userType,t,e,n)}},mounted:function(){var t=this;try{this.userType=Object(p.a)("userInfo").userType}catch(t){this.$router.push("/user/login")}this.RescueMenu=3==this.userType?h.c:h.a,this.initData();var e,n;3!=this.userType&&(e=function(e){t.infoData.splice(0,0,e),console.log(e)},(n=new WebSocket(s)).onopen=function(t){console.log("连接成功"),n.send("Hello WebSockets!")},n.onmessage=function(t){console.log("接受的数据是: "+t.data);var n="string"==typeof t.data?JSON.parse(t.data):t.data;e(n)},n.onclose=function(t){console.log("断开连接")})},components:{Personnel:d,BottomLine:n("zG2y").a,Confirm:o.a}},I={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"task"},[n("ul",{staticClass:"nav"},t._l(t.RescueMenu,function(e,a){return n("li",{key:a,class:{checked:a==t.navIndex-1},on:{click:function(e){t.navIndex=a+1,t.isShow()}}},[n("span",[t._v(t._s(e))])])})),t._v(" "),n("div",{staticClass:"ordersComm Orders"},[n("ul",t._l(t.infoData,function(e,a){return t.listIsShow(e)?n("li",{key:a,ref:"li",refInFor:!0,class:"order",on:{click:function(n){t.localItem(e)}}},[n("router-link",{attrs:{to:"/rescue/task/details"}},[n("div",{staticClass:"title"},[n("p",[t._v("救援单号："+t._s(e.uuid))]),t._v(" "),n("span",[t._v(t._s(t._f("status")(e.stateId,e)))])]),t._v(" "),3==t.userType?n("div",{staticClass:"track"},[n("i",{staticClass:"iconfont icon-che"}),t._v(" "),n("div",{staticClass:"r"},[n("h2",[t._v("【天佑救援机构】救援人员已经出发，预计1小时31分钟到 达救援地点。")]),t._v(" "),n("span",[t._v("2018-03-06 08:50:33")])])]):t._e(),t._v(" "),n("div",{staticClass:"info"},[n("img",{staticClass:"icon",attrs:{src:"",alt:""}}),t._v(" "),n("div",{staticClass:"con"},[n("h3",[t._v(t._s(t._f("office")(e.office)))]),t._v(" "),n("p",[n("span",[t._v(t._s(t._f("Rescue")(e.rangeId)))]),t._v(" "),n("b",[t._v(t._s(e.createDate))])])])])]),t._v(" "),""!==e.remarks?n("div",{staticClass:"note"},[n("i",{staticClass:"iconfont icon-jinggao"}),t._v(" "),n("span",[t._v("备注")]),t._v(" "),n("p",[t._v(t._s(e.remarks))])]):t._e(),t._v(" "),n("router-link",{attrs:{to:"/rescue/map"},nativeOn:{click:function(n){t.mapEv(e)}}},[n("div",{staticClass:"position"},[n("i",{staticClass:"iconfont icon-weizhi"}),t._v(" "),n("p",[t._v(t._s(e.place))]),t._v(" "),n("span",[t._v("22.22km")]),t._v(" "),n("b",{attrs:{href:""}},[t._v("查看地图 "),n("i",{staticClass:"iconfont icon-shuangjiantouyou"})])])]),t._v(" "),n("div",{staticClass:"btn"},t._l(e.btn,function(a,i){return n("div",{key:i,class:{file:"file"==a.type}},["file"==a.type?n("span",[t._v(t._s(a.name))]):t._e(),t._v(" "),n("input",{attrs:{type:a.type,accept:"image/*",capture:"camera"},domProps:{value:"button"==a.type?a.name:""},on:{click:function(n){t.accept(e,i,a.name)},change:t.imgResult}})])}))],1):t._e()})),t._v(" "),n("transition",{attrs:{name:"breadcrumb"}},[n("router-view"),t._v(" "),t.isShowPer?n("personnel",{attrs:{originaId:t.originaId},on:{down:t.downEv}}):t._e()],1)],1),t._v(" "),n("confirm",{attrs:{"hide-on-blur":!0,"show-input":!0,placeholder:"请输入取消理由",title:"取消理由",theme:"android","confirm-text":"确定","cancel-text":"取消"},on:{"on-confirm":t.cancelEv},model:{value:t.showCancel,callback:function(e){t.showCancel=e},expression:"showCancel"}}),t._v(" "),n("confirm",{attrs:{"hide-on-blur":!0,"show-input":!0,placeholder:"请输入拒绝理由",title:"拒绝理由",theme:"android","confirm-text":"确定","cancel-text":"取消"},on:{"on-confirm":t.cancelRefuseEv},model:{value:t.showCancelRefuse,callback:function(e){t.showCancelRefuse=e},expression:"showCancelRefuse"}}),t._v(" "),t.liLength>0?n("bottom-line"):t._e(),t._v(" "),0==t.liLength?n("div",{staticClass:"Empty"},[n("i",{staticClass:"iconfont icon-icondd1"}),n("p",[t._v("暂无数据")])]):t._e(),t._v(" "),3!=t.userType?n("div",{staticClass:"personal",on:{click:t.personal}},[n("i",{staticClass:"iconfont icon-wode"})]):n("div",{staticClass:"personal",on:{click:t.personal}},[n("i",{staticClass:"iconfont icon-home"})])],1)},staticRenderFns:[]};var j=n("VU/8")(C,I,!1,function(t){n("EjqE"),n("K3TS")},"data-v-9c587216",null);e.default=j.exports},wEVy:function(t,e,n){"use strict";var a,i,o=n("Xxa5"),s=n.n(o),c=n("exGp"),r=n.n(c),u=n("K2f2"),f=n("yclV"),l=(a=r()(s.a.mark(function t(e,n){var a,i,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Object(f.a)("userInfo").userType,i=e.navIndex,o=[],3!=a){t.next=14;break}if(1!=i){t.next=9;break}return t.next=7,Object(u.D)(n).then(function(t){o=t.rows});case 7:t.next=12;break;case 9:if(4!=i){t.next=12;break}return t.next=12,Object(u.C)(n).then(function(t){o=t.rows});case 12:t.next=17;break;case 14:if(2!=a){t.next=17;break}return t.next=17,Object(u.m)(n).then(function(t){o=t.rows});case 17:h(e,o,"infoData");case 18:case"end":return t.stop()}},t,this)})),function(t,e){return a.apply(this,arguments)}),d=(i=r()(s.a.mark(function t(e,n,a){var i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=[],t.next=3,Object(u.g)(n,a).then(function(t){i=t.rows,e.isShowLoading=!1});case 3:h(e,i,"data");case 4:case"end":return t.stop()}},t,this)})),function(t,e,n){return i.apply(this,arguments)});function h(t,e,n){e.forEach(function(e){t[n].push(e)})}var p,v=n("y1vT"),b=n.n(v);e.a=function(t){p=t,window.addEventListener("scroll",b()(m,500))};function m(){if(function(){var t=0,e=0;document.body&&(t=document.body.scrollTop);document.documentElement&&(e=document.documentElement.scrollTop);return t-e>0?t:e}()+function(){var t=0;t="CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight;return t}()==function(){var t=0,e=0;document.body&&(t=document.body.scrollHeight);document.documentElement&&(e=document.documentElement.scrollHeight);return t-e>0?t:e}())if(-1!==p.$route.path.indexOf("/rescue/task")){if(p.total<10*p.pageNum)return;p.pageNum++,l(p,p.pageNum)}else if(-1!==p.$route.path.indexOf("/user/home")){if(p.total<10*p.pageNum)return;p.isShowLoading=!0;var t="sense"==p.currentView?"1":"2";p.pageNum++,d(p,p.pageNum,t)}}},y1vT:function(t,e,n){(function(e){var n="Expected a function",a=NaN,i="[object Symbol]",o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,r=/^0o[0-7]+$/i,u=parseInt,f="object"==typeof e&&e&&e.Object===Object&&e,l="object"==typeof self&&self&&self.Object===Object&&self,d=f||l||Function("return this")(),h=Object.prototype.toString,p=Math.max,v=Math.min,b=function(){return d.Date.now()};function m(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function _(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&h.call(t)==i}(t))return a;if(m(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=m(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var n=c.test(t);return n||r.test(t)?u(t.slice(2),n?2:8):s.test(t)?a:+t}t.exports=function(t,e,a){var i,o,s,c,r,u,f=0,l=!1,d=!1,h=!0;if("function"!=typeof t)throw new TypeError(n);function g(e){var n=i,a=o;return i=o=void 0,f=e,c=t.apply(a,n)}function y(t){var n=t-u;return void 0===u||n>=e||n<0||d&&t-f>=s}function k(){var t=b();if(y(t))return w(t);r=setTimeout(k,function(t){var n=e-(t-u);return d?v(n,s-(t-f)):n}(t))}function w(t){return r=void 0,h&&i?g(t):(i=o=void 0,c)}function x(){var t=b(),n=y(t);if(i=arguments,o=this,u=t,n){if(void 0===r)return function(t){return f=t,r=setTimeout(k,e),l?g(t):c}(u);if(d)return r=setTimeout(k,e),g(u)}return void 0===r&&(r=setTimeout(k,e)),c}return e=_(e)||0,m(a)&&(l=!!a.leading,s=(d="maxWait"in a)?p(_(a.maxWait)||0,e):s,h="trailing"in a?!!a.trailing:h),x.cancel=function(){void 0!==r&&clearTimeout(r),f=0,i=u=o=r=void 0},x.flush=function(){return void 0===r?c:w(b())},x}}).call(e,n("DuR2"))},zG2y:function(t,e,n){"use strict";var a={props:["text"],data:function(){return{txt:""}},mounted:function(){this.txt=void 0!==this.text?this.text:"我是有底线的"}},i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bottomLine"},[e("p",[this._v(this._s(this.txt))])])},staticRenderFns:[]};var o=n("VU/8")(a,i,!1,function(t){n("OXZD")},"data-v-2935bb20",null);e.a=o.exports}});