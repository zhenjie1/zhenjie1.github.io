webpackJsonp([3],{VVKv:function(t,e){},WAr1:function(t,e){},WXYC:function(t,e){},a8gr:function(t,e,n){t.exports=n.p+"static/img/rescueDefault.jpg"},adrF:function(t,e){},eyOy:function(t,e,n){"use strict";var a=n("rVsN"),i=n.n(a),s=n("IvJb"),o=n("yclV");e.a=function(t){if(Object(o.d)())return i.a.resolve({});var e=o.b.call(this);return console.log(e),e?i.a.resolve(e):Object(o.c)()||"rescue"===t?new i.a(function(t,e){function n(e){var n=e.coords.longitude,a=e.coords.latitude;console.log("经度为:"+n+"纬度为:"+a),t({x:n,y:a})}function a(t){2==t.code&&s.a.$vux.toast.text("请打开您浏览器的位置权限"),s.a.$vux.toast.text({1:"用户拒绝定位服务",2:"获取不到定位信息",3:"获取定位信息超时"}[t.code]),e(!1)}navigator.geolocation?navigator.geolocation.getCurrentPosition(n,a,{enableHighAccuracy:!0,timeout:6e4,maximumAge:6e4}):alert("你的浏览器不支持定位，无法获取到您的位置！")}).catch(function(t){return t}):i.a.resolve({})}},sFWC:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("hRKE"),i=n.n(a),s=n("4YfN"),o=n.n(s),r=n("JGLT"),c="ws://"+n("ij9N").d+"/a/tjSocket",u=function(t){var e=new WebSocket(c);e.onopen=function(t){console.log("连接成功"),e.send("Hello WebSockets!")},e.onmessage=function(e){var n="string"==typeof e.data?JSON.parse(e.data):e.data;t(n)},e.onclose=function(t){console.log("断开连接")}},l=n("K2f2"),f={data:function(){return{data:[]}},props:["originaId"],methods:{ok:function(){var t=this,e=this,n=[];if(this.data.forEach(function(t){t.check&&n.push(t.id)}),0===n.length)return this.$vux.toast.text("请至少选择一人！"),!1;Object(l.b)(this.originaId,n).then(function(n){2==n.code?(e.$emit("down",!0),t.$vux.toast.text("接单成功")):e.$emit("down",n.msg)})},initData:function(){var t=this;Object(l.q)().then(function(e){t.data=e.rows})},down:function(){this.$emit("down",!1)}},mounted:function(){this.initData()}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"personnel"},[n("div",{staticClass:"con"},[n("div",{staticClass:"down",on:{click:t.down}},[n("i",{staticClass:"iconfont icon-guanbi"})]),t._v(" "),t._m(0),t._v(" "),n("div",{staticClass:"pers"},t._l(t.data,function(e,a){return 0==e.status?n("p",{key:a,class:{checked:e.check},on:{click:function(t){e.check=!e.check}}},[t._v(t._s(e.name))]):t._e()})),t._v(" "),n("div",{staticClass:"okBtn",on:{click:t.ok}},[n("span",[t._v("选择好了")])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tit"},[e("span",[this._v("请选择出勤人员")])])}]};var d,v,p=n("C7Lr")(f,h,!1,function(t){n("WXYC")},"data-v-84549c96",null).exports,m=n("vgQg"),b=n("yclV"),_=n("rVsN"),g=n.n(_),y=n("lC5x"),w=n.n(y),x=n("J0Oq"),k=n.n(x),C=n("HzJ8"),D=n.n(C),I=(d=k()(w.a.mark(function t(e){var n=this;return w.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next=1===t.t0?3:2===t.t0?6:3===t.t0?9:4===t.t0?12:5===t.t0?15:18;break;case 3:return t.next=5,Object(l.Z)(1).then(function(t){n.total=t.total,t=t.rows,n.infoData=t,n.originalData=t,O(n.infoData)});case 5:return t.abrupt("break",18);case 6:return t.next=8,Object(l._0)().then(function(t){t=t.rows,n.infoData=t,n.originalData=t,O(n.infoData)});case 8:return t.abrupt("break",18);case 9:return t.next=11,Object(l.X)().then(function(t){t=t.rows,n.infoData=t,n.originalData=t,O(n.infoData)});case 11:return t.abrupt("break",18);case 12:return t.next=14,Object(l.Y)(1).then(function(t){t=t.rows,n.infoData=t,n.originalData=t,O(n.infoData)});case 14:return t.abrupt("break",18);case 15:return t.next=17,Object(l.Z)(1,"99").then(function(t){t=t.rows,n.infoData=t,n.originalData=t,O(n.infoData)});case 17:return t.abrupt("break",18);case 18:this.$refs.li&&(this.liLength=this.$refs.li.length);case 19:case"end":return t.stop()}},t,this)})),function(t){return d.apply(this,arguments)});function O(t){var e=!0,n=!1,a=void 0;try{for(var i,s=D()(t);!(e=(i=s.next()).done);e=!0){var o=i.value;0==o.orderStautsList.length&&o.orderStautsList.push({content:"暂无进展"})}}catch(t){n=!0,a=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw a}}}var j=function(){var t=this;switch(v=function t(){try{return this.$store.state.userInfo.userType}catch(e){setTimeout(function(){return t()},100)}}.call(this),parseInt(this.userType)){case 2:Object(l.p)().then(function(e){e=e.rows,t.infoData=e,t.originalData=e,O(t.infoData)}).then(function(){S.call(t)});break;case 3:Object(l.Z)(1).then(function(e){t.total=e.total,e=e.rows,t.infoData=e,t.originalData=e,t.liLength=e.length,O(t.infoData),Object(l.c)(t.infoData[0].uuid).then(function(t){console.log(t)})});break;case 4:Object(l.o)(1).then(function(e){e=e.rows,t.infoData=e,t.originalData=e,O(t.infoData)}).then(function(){S.call(t)})}},$=function(t,e,n,a,i){e=parseInt(e),t.clickObj=n,t.originaId=n.id,2===e?L(t,n,a,i):3===e?(0==a&&"救援进展"==i&&t.$router.push("/rescue/task/progress"),0==a&&-1!==i.indexOf("取消")&&(t.showCancel=!0)):4===e&&L(t,n,a,i)},S=function(){var t=this.navIndex;3==v?I.call(this,t):function(t){var e=this;new g.a(function(n,a){4!=t?(Array.isArray(e.originalData)&&(e.infoData=e.originalData.filter(function(e){return 1==t?0==e.stateId||1==e.stateId:t==e.stateId}),O(e.infoData),n()),a("this.originalData 不是一个数组")):Object(l.r)(1,10).then(function(t){t=t.rows,e.infoData=t,O(e.infoData),n()})}).then(function(){e.total=e.infoData.length,setTimeout(function(){return e.liLength=void 0==e.$refs.li?0:e.$refs.li.length},0)})}.call(this,t)},E=function(t,e){var n=["等待接单","等待出发","已到达救援地点","施救中","完成"];n[99]="已取消";var a=[[{name:"拒绝接单",type:"button"},{name:"确认接单",type:"button"}],[{name:"确认出发",type:"button"}],[{name:"拍摄",type:"file"},{name:"确认到达",type:"button"}],[{name:"拍摄",type:"file"},{name:"完成",type:"button"}],[{name:"0"===e.typeReport?"上传报告":"查看报告",type:"button"},{name:"0"===e.typeReturn?"上传回访":"查看回访",type:"button"}]];return t=parseInt(t),2==v?e.btn=a[t]:3==v?(a=[[{name:"取消订单",type:"button"}],[{name:"救援进展",type:"button"}]],e.btn=0==t?a[0]:a[1]):4==v&&(e.btn=a[t]),n[t]};function L(t,e,n,a){switch(e.stateId=parseInt(e.stateId),e.stateId){case 0:1==n?(t.originaId=e.id,t.isShowPer=!0):t.showCancelRefuse=!0;break;case 2:case 3:1==n&&t.statusSet(e);break;case 4:0==n?"上传报告"==a?t.$router.push("/rescue/task/update/"+e.id+"/1"):"查看报告"==a&&t.$router.push("/rescue/report/"+e.id+"/1"):"上传回访"==a?t.$router.push("/rescue/task/update/"+e.id+"/0"):"查看回访"==a&&t.$router.push("/rescue/report/"+e.id+"/0"),console.log("不请求，而是跳转页面 --- 点击的是第 "+n+" 个"),-1!==a.indexOf("上传")&&console.log("点击的是上传·");break;default:console.log("报错了，快去看看代码吧！"),t.statusSet(e)}}var R=n("wEVy"),T=n("zG2y"),V=n("9rMa"),N=n("eyOy"),P=(o()({},Object(V.mapState)(["userInfo","homeUrl"])),T.a,r.a,{data:function(){return{showCancelRefuse:!1,showCancel:!1,navIndex:1,currentView:"orders",isShowPer:!1,infoData:[],pageNum:1,liLength:-1,userType:"",total:0,socketData:{},originalData:[],originaId:"",clickObj:"",test:"",RescueMenu:[]}},computed:o()({},Object(V.mapState)(["userInfo","homeUrl"])),filters:{office:function(t){return"object"==(void 0===t?"undefined":i()(t))?t.name:""==t||void 0==t?"救援机构未分配":t},status:function(t,e){return E(t,e)}},watch:{$route:"initData"},created:function(){b.e.call(this)||(this.$vux.toast.text("请先登录！"),this.$router.push("/user/login")),Object(R.a)(this),N.a.call(this)},methods:{cancelRefuseEv:function(t){var e=this;""!=t?Object(l.h)(this.originaId,t).then(function(t){e.clickObj.stateId="99"}):this.$vux.toast.text("请输入拒绝理由！")},localItem:function(t){Object(b.i)("viewCurrentData",t)},cancelEv:function(t){var e=this;""!=t?Object(l.i)(this.originaId,t).then(function(t){e.clickObj.stateId="99"}):this.$vux.toast.text("请输入拒绝理由！")},mapEv:function(t){sessionStorage.lngLat=t.jingwei},imgResult:function(t){t.target.files.length>0&&this.$vux.toast.text("拍摄成功")},listIsShow:function(t){return 3==this.userType||(1==this.navIndex?0==t.stateId||1==t.stateId:t.stateId==this.navIndex)},isShow:function(){S.call(this)},personal:function(){3==this.userType?this.$router.push(this.homeUrl||"/"):this.$router.push("/personal")},initData:function(){j.call(this,this.userType)},downEv:function(t){if(!0===t){for(var e=0;e<this.infoData.length;e++)if(this.infoData[e].id==this.originaId){this.infoData[e].stateId=1;break}this.isShowPer=!1}else!1===t?this.isShowPer=!1:this.$vux.toast.text(t)},statusSet:function(t){Object(l.G)(t.id,t.stateId+1).then(function(e){2==e.code&&(t.stateId=t.stateId+1)})},accept:function(t,e,n){$(this,this.userType,t,e,n)}},mounted:function(){var t=this;b.e.call(this)&&this.$route.query.type&&"2"!=this.$route.query.type&&"4"!=this.$route.query.type&&this.$router.push(this.homeUrl),this.userType=this.userInfo.userType,this.RescueMenu=3==this.userType?m.c:m.a,this.initData();u(function(e){1==e.code?(t.$vux.toast.text("你有新的任务"),t.infoData.splice(0,0,e.rows)):3==e.code||2==e.code&&(t.$vux.toast.text("你有新的任务"),t.infoData.splice(0,0,e.rows))})},components:{Personnel:p,BottomLine:T.a,Confirm:r.a}}),q={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task"},[a("ul",{staticClass:"nav"},t._l(t.RescueMenu,function(e,n){return a("li",{key:n,class:{checked:n==t.navIndex-1},on:{click:function(e){t.navIndex=n+1,t.isShow()}}},[a("span",[t._v(t._s(e))])])})),t._v(" "),a("div",{staticClass:"ordersComm Orders"},[a("ul",t._l(t.infoData,function(e,i){return t.listIsShow(e)?a("li",{key:i,ref:"li",refInFor:!0,class:"order",on:{click:function(n){t.localItem(e)}}},[a("router-link",{attrs:{to:"/rescue/task/details"}},[a("div",{staticClass:"title"},[a("p",[t._v("救援单号："+t._s(e.uuid))]),t._v(" "),a("span",[t._v(t._s(t._f("status")(e.stateId,e)))])]),t._v(" "),3==t.userType?a("div",{staticClass:"track"},[a("i",{staticClass:"iconfont icon-che"}),t._v(" "),a("div",{staticClass:"r"},[a("h2",[t._v(t._s(e.orderStautsList[0].content))]),t._v(" "),a("span",[t._v(t._s(e.createDate))])])]):t._e(),t._v(" "),a("div",{staticClass:"info"},[a("img",{staticClass:"icon",attrs:{src:n("a8gr"),alt:""}}),t._v(" "),a("div",{staticClass:"con"},[a("h3",[t._v(t._s(t._f("office")(e.office)))]),t._v(" "),a("p",[a("span",[t._v(t._s(t._f("Rescue")(e.rangeId)))]),t._v(" "),a("b",[t._v(t._s(e.createDate))])])])])]),t._v(" "),""!==e.remarks?a("div",{staticClass:"note"},[a("i",{staticClass:"iconfont icon-jinggao"}),t._v(" "),a("span",[t._v("备注")]),t._v(" "),a("p",[t._v(t._s(e.remarks))])]):t._e(),t._v(" "),3!=t.userType?a("router-link",{attrs:{to:"/rescue/map"},nativeOn:{click:function(n){t.mapEv(e)}}},[a("div",{staticClass:"position"},[a("i",{staticClass:"iconfont icon-weizhi"}),t._v(" "),a("p",[t._v(t._s(e.place))]),t._v(" "),a("span",{staticStyle:{opacity:"0"}},[t._v("22.22km")]),t._v(" "),a("b",{attrs:{href:""}},[t._v("查看地图 "),a("i",{staticClass:"iconfont icon-shuangjiantouyou"})])])]):a("div",[a("div",{staticClass:"position"},[a("i",{staticClass:"iconfont icon-weizhi"}),t._v(" "),a("p",[t._v(t._s(e.place))])])]),t._v(" "),99!=e.stateId?a("div",{staticClass:"btn"},t._l(e.btn,function(n,i){return a("div",{key:i,class:{file:"file"==n.type}},["file"==n.type?a("span",[t._v(t._s(n.name))]):t._e(),t._v(" "),a("input",{attrs:{type:n.type,accept:"image/*",capture:"camera"},domProps:{value:"button"==n.type?n.name:""},on:{click:function(a){t.accept(e,i,n.name)},change:t.imgResult}})])})):t._e()],1):t._e()})),t._v(" "),a("transition",{attrs:{name:"breadcrumb"}},[a("router-view"),t._v(" "),t.isShowPer?a("personnel",{attrs:{originaId:t.originaId},on:{down:t.downEv}}):t._e()],1)],1),t._v(" "),a("confirm",{attrs:{"hide-on-blur":!0,"show-input":!0,placeholder:"请输入取消理由",title:"取消理由",theme:"android","confirm-text":"确定","cancel-text":"取消"},on:{"on-confirm":t.cancelEv},model:{value:t.showCancel,callback:function(e){t.showCancel=e},expression:"showCancel"}}),t._v(" "),a("confirm",{attrs:{"hide-on-blur":!0,"show-input":!0,placeholder:"请输入拒绝理由",title:"拒绝理由",theme:"android","confirm-text":"确定","cancel-text":"取消"},on:{"on-confirm":t.cancelRefuseEv},model:{value:t.showCancelRefuse,callback:function(e){t.showCancelRefuse=e},expression:"showCancelRefuse"}}),t._v(" "),t.liLength>0?a("bottom-line"):t._e(),t._v(" "),0==t.liLength?a("div",{staticClass:"Empty"},[a("i",{staticClass:"iconfont icon-icondd1"}),t._v(" "),a("p",[t._v("暂无数据")])]):t._e(),t._v(" "),3!=t.userType?a("div",{staticClass:"personal",on:{click:t.personal}},[a("i",{staticClass:"iconfont icon-wode"})]):a("div",{staticClass:"personal",on:{click:t.personal}},[a("i",{staticClass:"iconfont icon-home"})])],1)},staticRenderFns:[]};var F=n("C7Lr")(P,q,!1,function(t){n("adrF"),n("VVKv")},"data-v-472e09ec",null);e.default=F.exports},wEVy:function(t,e,n){"use strict";var a,i,s=n("lC5x"),o=n.n(s),r=n("J0Oq"),c=n.n(r),u=n("K2f2"),l=n("yclV"),f=(a=c()(o.a.mark(function t(e,n){var a,i,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Object(l.a)("userInfo").userType,i=e.navIndex,s=[],3!=a){t.next=14;break}if(1!=i){t.next=9;break}return t.next=7,Object(u.Z)(n).then(function(t){s=t.rows});case 7:t.next=12;break;case 9:if(4!=i){t.next=12;break}return t.next=12,Object(u.Y)(n).then(function(t){s=t.rows});case 12:t.next=17;break;case 14:if(2!=a){t.next=17;break}return t.next=17,Object(u.r)(n).then(function(t){s=t.rows});case 17:d(e,s,"infoData");case 18:case"end":return t.stop()}},t,this)})),function(t,e){return a.apply(this,arguments)}),h=(i=c()(o.a.mark(function t(e,n,a){var i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=[],t.next=3,Object(u.k)(n,a).then(function(t){i=t.rows,e.isShowLoading=!1});case 3:d(e,i,"data");case 4:case"end":return t.stop()}},t,this)})),function(t,e,n){return i.apply(this,arguments)});function d(t,e,n){e.forEach(function(e){t[n].push(e)})}var v,p=n("bBgq"),m=n.n(p);e.a=function(t){v=t,window.addEventListener("scroll",m()(b,100))};function b(){if(function(){var t=0,e=0;document.body&&(t=document.body.scrollTop);document.documentElement&&(e=document.documentElement.scrollTop);return t-e>0?t:e}()+function(){var t=0;t="CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight;return t}()==function(){var t=0,e=0;document.body&&(t=document.body.scrollHeight);document.documentElement&&(e=document.documentElement.scrollHeight);return t-e>0?t:e}())if(-1!==v.$route.path.indexOf("/rescue/task")){if(v.total<10*v.pageNum)return;v.pageNum++,f(v,v.pageNum)}else if(-1!==v.$route.path.indexOf("/user/home")){if(v.total<10*v.pageNum)return;v.isShowLoading=!0;var t="sense"==v.currentView?"1":"2";v.pageNum++,h(v,v.pageNum,t)}}},zG2y:function(t,e,n){"use strict";var a={props:["text"],data:function(){return{txt:""}},mounted:function(){this.txt=void 0!==this.text?this.text:"我是有底线的"}},i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bottomLine"},[e("p",[this._v(this._s(this.txt))])])},staticRenderFns:[]};var s=n("C7Lr")(a,i,!1,function(t){n("WAr1")},"data-v-2935bb20",null);e.a=s.exports}});